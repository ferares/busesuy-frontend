<h1 class="visually-hidden">
  BusesUY - Buscador de líneas de ómnibus
</h1>
<div class="page-home py-4" style="background-image:url('{{background?.picture}}')">
  <ng-container *ngIf="background">
    <ng-template #datosFoto>
      <ul class="list-unstyled">
        <li class="mb-3 mt-1">
          <img class="me-1" height="20" width="20" src="assets/imgs/person-frame.svg" alt="Tomada por:">
          <a *ngIf="background.user.link" href="{{background.user.link}}" target="_blank" rel="noreferrer">
            {{background.user.name}}
          </a>
          <span *ngIf="!background.user.link">
            {{background.user.name}}
          </span>
        </li>
        <li>
          <img height="20" width="20" src="assets/imgs/location.svg" alt="En:">
          <span class="ms-1">
            {{background.location}}
          </span>
        </li>
      </ul>
      <a class="btn btn-secondary w-100" href="{{background.picture}}" target="_blank">
        Ver foto
      </a>
    </ng-template>
    <button
      type="button"
      class="page-home__bg-data-btn"
      [popover]="datosFoto"
      [outsideClick]="true"
      popoverTitle="Datos de la foto"
      placement="top"
    >
      <img src="assets/imgs/camera.svg" alt="Sobre la foto de fondo" width="20" height="20">
    </button>
  </ng-container>
  <div class="container d-flex align-items-center justify-content-center h-100">
    <div class="row w-100">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-body">
            <form class="row g-3 home__form" [ngClass]="{ 'was-validated': validated }" novalidate (submit)="search()">
              <div class="col-12">
                <div class="home__form__top">
                  <div class="home__form__block">
                    <label for="origin" class="form-label">
                      Origen
                    </label>
                    <app-location-input
                      id="origin"
                      name="origin"
                      [(ngModel)]="origin"
                      [required]="true"
                      [locations]="locations"
                      invalidFeedback="Ingrese un origen."
                    >
                    </app-location-input>
                  </div>
                  <div class="home__form__block">
                    <button type="button" class="btn btn-primary d-block w-100 home__form__swap-btn" (click)="swapLocations()">
                      <img src="assets/imgs/arrow-double.svg" height="20" width="20" alt="Cambiar origen y destino">
                    </button>
                  </div>
                  <div class="home__form__block">
                    <label for="destination" class="form-label">
                      Destino
                    </label>
                    <app-location-input
                      id="destination"
                      name="destination"
                      [(ngModel)]="destination"
                      [required]="true"
                      [locations]="locations"
                      invalidFeedback="Ingrese un destino."
                    >
                    </app-location-input>
                  </div>
                  <div class="home__form__block">
                    <label id="date" class="form-label">
                      Día
                    </label>
                    <div class="btn-group d-flex" dropdown>
                      <button dropdownToggle type="button" class="form-select text-truncate" aria-controls="dropdown-date">
                        {{ getSelectedDaysString() }}
                      </button>
                      <ul id="dropdown-date" *dropdownMenu class="dropdown-menu w-100" role="menu" aria-labelledby="date">
                        <li *ngFor="let day of days" role="menuitem" [ngClass]="{ 'bg-light': selectedDays.includes(day.value) }">
                          <span class="dropdown-item" (click)="toggleDay($event, day.value)">
                            {{ day.label }}
                          </span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <alert type="warning" [dismissible]="true" class="mb-0">
                  <div class="d-flex align-items-center">
                    <img src="assets/imgs/shield.svg" width="32" height="32" class="flex-shrink-0 me-2" alt="">
                    <span>
                      Dada la situación sanitaria por COVID-19 estos datos están
                      sujetos a cambios sin previo aviso. Verifíquelos en cada
                      caso con las compañías.
                    </span>
                  </div>
                </alert>
              </div>
              <div class="col-md-4 offset-md-4 mt-0">
                <button class="btn btn-primary w-100" type="submit">
                  Buscar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div #resultsElement>
        <div *ngIf="results" class="col-12 mt-4">
          <div class="card shadow">
            <div class="card-body">
              <h2 class="card-title h5">
                Líneas
              </h2>
              <app-results-table [results]="results" [origin]="resultsOrigin" [destination]="resultsDestination">
              </app-results-table>
            </div>
          </div>
        </div>
        <div *ngIf="(!results || !results.length) && indirectResults" class="col-12 mt-4">
          <div class="card shadow">
            <div class="card-body">
              <h2 class="card-title h5">
                Transbordos
              </h2>
              <p *ngIf="!indirectResults || !indirectResults.length" class="lead mb-0">
                No hay resultados
              </p>
              <accordion *ngIf="indirectResults && indirectResults.length" [isAnimated]="true">
                <accordion-group *ngFor="let result of indirectResults">
                  <button
                    type="button"
                    class="results-indirect__accordion-heading"
                    accordion-heading
                  >
                    <span class="text-nowrap text-truncate w-100">
                      {{result[0].origin}}, {{result[0].originDepartment}}
                    </span>
                    <img class="results-indirect__accordion-heading__arrow" width="20" height="20" src="assets/imgs/arrow-left.svg" alt="con escala en">
                    <span class="text-nowrap text-truncate w-100">
                      {{result[0].destination}}, {{result[0].destinationDepartment}}
                    </span>
                    <img class="results-indirect__accordion-heading__arrow" width="20" height="20" src="assets/imgs/arrow-left.svg" alt="con destino">
                    <span class="text-nowrap text-truncate w-100">
                      {{result[1].destination}}, {{result[1].destinationDepartment}}
                    </span>
                    <img class="panel-chevron" width="20" height="20" src="assets/imgs/chevron-down.svg" alt="Expandir/Colapsar">
                  </button>

                  <accordion [isAnimated]="true">
                    <accordion-group>
                      <button
                        type="button"
                        class="results-indirect__accordion-heading results-indirect__accordion-heading--scale"
                        accordion-heading
                      >
                        <span class="text-nowrap text-truncate w-100">
                          {{result[0].origin}}, {{result[0].originDepartment}}
                        </span>
                        <img class="results-indirect__accordion-heading__arrow" width="20" height="20" src="assets/imgs/arrow-left.svg" alt="hacia">
                        <span class="text-nowrap text-truncate w-100">
                          {{result[0].destination}}, {{result[0].destinationDepartment}}
                        </span>
                        <img class="panel-chevron" width="20" height="20" src="assets/imgs/chevron-down.svg" alt="Expandir/Colapsar">
                      </button>
                      <app-results-table [results]="result[0].lines" [origin]="result[0].origin + ', ' + result[0].originDepartment" [destination]="result[0].destination + ', ' + result[0].destinationDepartment">
                      </app-results-table>
                    </accordion-group>
                    <accordion-group>
                      <button
                        type="button"
                        class="results-indirect__accordion-heading results-indirect__accordion-heading--scale"
                        accordion-heading
                      >
                        <span class="text-nowrap text-truncate w-100">
                          {{result[1].origin}}, {{result[1].originDepartment}}
                        </span>
                        <img class="results-indirect__accordion-heading__arrow" width="20" height="20" src="assets/imgs/arrow-left.svg" alt="hacia">
                        <span class="text-nowrap text-truncate w-100">
                          {{result[1].destination}}, {{result[1].destinationDepartment}}
                        </span>
                        <img class="panel-chevron" width="20" height="20" src="assets/imgs/chevron-down.svg" alt="Expandir/Colapsar">
                      </button>
                      <app-results-table [results]="result[1].lines" [origin]="result[1].origin + ', ' + result[1].originDepartment" [destination]="result[1].destination + ', ' + result[1].destinationDepartment">
                      </app-results-table>
                    </accordion-group>
                  </accordion>
                </accordion-group>
              </accordion>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
