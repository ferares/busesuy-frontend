<section class="home-content" style="background-image:url('{{background?.picture}}')">
  <div class="content">

    <!--Covid Message-->
    <alert type="warning" [dismissible]="true">
        <i class="fa-solid fa-virus-covid"></i>
        <p>Dada la situación sanitaria por COVID-19 estos datos están sujetos a cambios sin previo aviso.<br />Verifíquelos en cada caso con las compañías.</p>
    </alert>

    <!--Search Form-->
    
    <div class="search-form">
      
      <h1 i18n>Buscador de líneas de ómnibus</h1>

      <form class="row g-3 home__form" [ngClass]="{ 'was-validated': validated }" novalidate (submit)="search()">

        <!--Origin-->
        <div class="origin-box">
          <label for="origin" i18n>Origen</label>
          <div dropdown #originOptions="bs-dropdown">
            <input #originElement type="text" class="form-control" id="origin" [(ngModel)]="origin" name="origin" autocomplete="off" required dropdownToggle (input)="handleInput('origin')" (click)="handleInput('origin')" (keydown)="handleIntro('origin', $event)">
            <ul *dropdownMenu class="dropdown-menu" role="menu">
              <li *ngFor="let location of filteredLocations; let i = index" role="menuitem">
                <button type="button" class="dropdown-item" (click)="setLocation('origin', i)" [innerHTML]="location.target"></button>
              </li>
            </ul>
            <div class="invalid-feedback" i18n>Ingrese un origen.</div>
          </div>
        </div>

        <!--Switch Origin and Destiny-->
        <button type="button" (click)="swapLocations()" class="swap-locations">
          <i class="fa-solid fa-arrows-rotate"></i>
        </button>

        <!--Destiny-->
        <div class="destiny-box">
          <label for="destination" i18n>Destino</label>
          <div dropdown #destinationOptions="bs-dropdown">

            <input type="text" class="form-control" id="destination" [(ngModel)]="destination" name="destination" autocomplete="off" required dropdownToggle (input)="handleInput('destination')" (click)="handleInput('destination')" (keydown)="handleIntro('destination', $event)">
            <div class="invalid-feedback" i18n>Ingrese un destino.</div>

            <ul *dropdownMenu class="dropdown-menu" role="menu">
              <li *ngFor="let location of filteredLocations; let i = index" role="menuitem">
                <button type="button" class="dropdown-item" (click)="setLocation('destination', i)" [innerHTML]="location.target">
                </button>
              </li>
            </ul>

          </div>
        </div>

        <!--Day-->
        <div class="day-box">
          <label id="date" class="form-label" i18n>Día</label>
          <div class="button-group" dropdown>
            <button dropdownToggle type="button" class="day" aria-controls="dropdown-date">{{ getSelectedDaysString() }}</button>
            <ul id="dropdown-date" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="date">
              <li *ngFor="let day of days" role="menuitem" [ngClass]="{ 'bg-light': selectedDays.includes(day.value) }">
                <span class="dropdown-item" (click)="toggleDay($event, day.value)">{{ day.label }}</span>
              </li>
            </ul>
          </div>
        </div>

        <!--Search Button-->
        <button type="submit" class="search-button" i18n>
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>

      </form>

    </div>

    <!--Search Results--> 
    <div #resultsElement>

      <div *ngIf="results" class="lines-results">
          <h2 i18n>Líneas</h2>
          <app-results-table [results]="results" [origin]="resultsOrigin" [destination]="resultsDestination"></app-results-table>
      </div>

      <div *ngIf="results" class="transboard-results">

        <div *ngIf="(!results || !results.length) && indirectResults" class="col-12 mt-4">
          <div class="card shadow">
            <div class="card-body">
              
              <div class="no-results">
                <h2 i18n>Transbordos</h2>
                <p *ngIf="!indirectResults || !indirectResults.length" class="lead mb-0" i18n>No hay resultados</p>
              </div>
              
              <accordion *ngIf="indirectResults && indirectResults.length" [isAnimated]="true">
                <accordion-group *ngFor="let result of indirectResults">

                  <button type="button" class="path-card" accordion-heading>
                      
                      <div class="pather">
                        <span class="path-dot">{{result[0].origin}}, {{result[0].originDepartment}}</span>
                        <span class="path-dot">{{result[0].destination}}, {{result[0].destinationDepartment}}</span>
                        <span class="path-dot">{{result[1].destination}}, {{result[1].destinationDepartment}}</span>
                      </div>

                      <i class="fa-solid fa-angle-down collapse-arrow"></i>
                  </button>

                  <accordion [isAnimated]="true">
                    <accordion-group>
                      
                      <button type="button" class="path-card expanded-card" accordion-heading>
                        <div class="pather">
                          <span class="path-dot">{{result[0].origin}}, {{result[0].originDepartment}}</span>
                          <span class="path-dot">{{result[0].destination}}, {{result[0].destinationDepartment}}</span>
                        </div>
                        
                        <i class="fa-solid fa-angle-down collapse-arrow"></i>
                      </button>

                      <app-results-table [results]="result[0].lines" [origin]="result[0].origin + ', ' + result[0].originDepartment" [destination]="result[0].destination + ', ' + result[0].destinationDepartment">

                      </app-results-table>
                    </accordion-group>

                    <accordion-group>
                      
                      <button type="button" class="path-card expanded-card" accordion-heading>

                        <div class="pather">
                          <span class="path-dot">{{result[1].origin}}, {{result[1].originDepartment}}</span>
                          <span class="path-dot">{{result[1].destination}}, {{result[1].destinationDepartment}}</span>
                        </div>

                        <i class="fa-solid fa-angle-down collapse-arrow"></i>
                      </button>

                      <app-results-table [results]="result[1].lines" [origin]="result[1].origin + ', ' + result[1].originDepartment" [destination]="result[1].destination + ', ' + result[1].destinationDepartment"></app-results-table>

                    </accordion-group>
                  </accordion>
                </accordion-group>
              </accordion>
            </div>
          </div>
        </div>      
      </div>


    </div>

    

    
    <!--Background Info-->
    <ng-container *ngIf="background">
      <ng-template #backgroundPopover bsPopover>
        <ul class="list-unstyled">
          <li class="mb-3 mt-1">
            <img class="me-1" height="20" width="20" src="assets/imgs/person-frame.svg" i18n-alt alt="Tomada por:">
            <a *ngIf="background.user.link" href="{{background.user.link}}" target="_blank" rel="noreferrer">{{background.user.name}}</a>
            <span *ngIf="!background.user.link">
              {{background.user.name}}
            </span>
          </li>
          <li>
            <img height="20" width="20" src="assets/imgs/location.svg" i18n-alt alt="En:">
            <span class="ms-1">
              {{background.location}}
            </span>
          </li>
        </ul>
        <a class="btn btn-primary w-100 mb-2" href="{{background.picture}}" target="_blank" i18n>
          Ver foto
        </a>
        <button type="button" class="btn btn-secondary w-100" (click)="backgroundsModal.show();backgroundPopover2.click();" i18n>
          Compartí tus fotos
        </button>
      </ng-template>
      
      <button #backgroundPopover2 type="button" class="camera-button" [popover]="backgroundPopover" [outsideClick]="true" i18n-popoverTitle popoverTitle="Datos de la foto" placement="top">
        <i class="fa-solid fa-camera"></i>
      </button>

    </ng-container>
  

    <!--Share Photos-->
    <div bsModal #backgroundsModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="backgrounds-modal-title" style="display: none;">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 id="backgrounds-modal-title" class="modal-title pull-left" i18n>
              Compartí tus fotos
            </h4>
            <button type="button" class="btn-close close pull-right" aria-label="Cerrar" i18n-aria-label (click)="backgroundsModal.hide()">
              <span aria-hidden="true" class="visually-hidden">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <app-backgrounds>
            </app-backgrounds>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>