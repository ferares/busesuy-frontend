<section class="home-content" style="background-image:url('{{background?.picture}}')">
  <div class="content">

    <!--Covid-19 Message-->
    <app-alert type="warning" [dismissible]="true">
      <i class="fa-solid fa-virus-covid"></i>
      <p>Dada la situación sanitaria por COVID-19 estos datos están sujetos a cambios sin previo aviso.<br />Verifíquelos en cada caso con las compañías.</p>
    </app-alert>

    <!--Search Form-->

    <div class="search-form">

      <h1 class="title-icon" i18n>
        <i class="fa-solid fa-bus"></i>Buscador de líneas de ómnibus en Uruguay
      </h1>

      <form class="row g-3 home__form" [ngClass]="{ 'was-validated': validated }" novalidate (submit)="search()">

        <!--Origin-->
        <div class="origin-box">
          <label for="origin" i18n>Origen</label>
          <app-location-input input-id="origin" name="origin" [options]="locations" [(ngModel)]="origin">
          </app-location-input>
        </div>

        <!--Switch Origin and Destiny-->
        <button type="button" (click)="swapLocations()" class="swap-locations">
          <i class="fa-solid fa-arrows-rotate"></i>
        </button>

        <!--Destiny-->
        <div class="destiny-box">
          <label for="destination" i18n>Destino</label>
          <app-location-input input-id="destination" name="destination" [options]="locations" [(ngModel)]="destination">
          </app-location-input>
        </div>

        <!--Day-->
        <div class="day-box">
          <label for="date" class="form-label" i18n>Día</label>
          <app-day-input name="date" [(ngModel)]="selectedDays">
          </app-day-input>
        </div>

        <!--Search Button-->
        <button type="submit" class="search-button" i18n>
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>

      </form>

    </div>

    <!--Search Results-->
    <div #resultsElement>

      <div *ngIf="results" class="lines-results">
          <h2 i18n>Líneas</h2>
          <app-results-table [results]="results" [origin]="resultsOrigin" [destination]="resultsDestination"></app-results-table>
      </div>

      <div *ngIf="results" class="transboard-results">

        <div *ngIf="(!results || !results.length) && indirectResults">
          <div class="card shadow">
            <div class="card-body">

              <h2 i18n>Transbordos</h2>

              <div class="no-results" *ngIf="!indirectResults || !indirectResults.length" i18n>
                <i class="fa-solid fa-magnifying-glass"></i>
                <p>No hay resultados</p>
              </div>

              <ng-container *ngIf="indirectResults && indirectResults.length">
                <app-accordion *ngFor="let result of indirectResults">

                  <button type="button" class="path-card" accordion-heading>

                      <div class="pather">
                        <span class="path-dot">{{result[0].origin}}, {{result[0].originDepartment}}</span>
                        <span class="path-dot">{{result[0].destination}}, {{result[0].destinationDepartment}}</span>
                        <span class="path-dot">{{result[1].destination}}, {{result[1].destinationDepartment}}</span>
                      </div>

                      <i class="fa-solid fa-angle-down collapse-arrow"></i>
                  </button>

                  <app-accordion>

                    <button type="button" class="path-card expanded-card" accordion-heading>
                      <div class="pather">
                        <span class="path-dot">{{result[0].origin}}, {{result[0].originDepartment}}</span>
                        <span class="path-dot">{{result[0].destination}}, {{result[0].destinationDepartment}}</span>
                      </div>

                      <i class="fa-solid fa-angle-down collapse-arrow"></i>
                    </button>

                    <app-results-table [results]="result[0].lines" [origin]="result[0].origin + ', ' + result[0].originDepartment" [destination]="result[0].destination + ', ' + result[0].destinationDepartment">

                    </app-results-table>
                  </app-accordion>

                  <app-accordion>

                    <button type="button" class="path-card expanded-card" accordion-heading>

                      <div class="pather">
                        <span class="path-dot">{{result[1].origin}}, {{result[1].originDepartment}}</span>
                        <span class="path-dot">{{result[1].destination}}, {{result[1].destinationDepartment}}</span>
                      </div>

                      <i class="fa-solid fa-angle-down collapse-arrow"></i>
                    </button>

                    <app-results-table [results]="result[1].lines" [origin]="result[1].origin + ', ' + result[1].originDepartment" [destination]="result[1].destination + ', ' + result[1].destinationDepartment"></app-results-table>

                  </app-accordion>

                </app-accordion>
              </ng-container>
            </div>
          </div>
        </div>
      </div>


    </div>




    <!--Background Info-->
    <ng-container *ngIf="background">
      <app-popover #backgroundPopover>
        <h4 class="popover-title">Datos de la foto</h4>
        <ul class="list-unstyled">
          <li>
            <i class="fa-solid fa-circle-user"></i>
            <a *ngIf="background.user.link" href="{{background.user.link}}" target="_blank" rel="noreferrer">{{background.user.name}}</a>
            <span *ngIf="!background.user.link">{{background.user.name}}</span>
          </li>
          <li>
            <i class="fa-solid fa-location-dot"></i>
            <span class="ms-1">{{background.location}}</span>
          </li>
        </ul>
        <a class="btn" href="{{background.picture}}" target="_blank" i18n>Ver foto</a>
        <button class="btn" type="button" (click)="backgroundsModal.open();backgroundPopover.close()" i18n>Compartí tus fotos</button>
      </app-popover>

      <button type="button" class="camera-button" (click)="backgroundPopover.open()">
        <i class="fa-solid fa-camera"></i>
      </button>

    </ng-container>


    <!--Share Photos-->
    <app-modal #backgroundsModal>
      <div modal-heading>
        <h4 id="backgrounds-modal-title" class="modal-title pull-left" i18n>
          Compartí tus fotos
        </h4>
        <button type="button" class="btn-close close pull-right" aria-label="Cerrar" i18n-aria-label (click)="backgroundsModal.close()">
          <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
      </div>
      <app-backgrounds>
      </app-backgrounds>
    </app-modal>

  </div>
</section>
